---
layout: post
title: "코드리뷰, 이렇게 하고 있습니다."
author: steve
categories: [codereview]
description: 안드로이드팀이 코드리뷰를 하는 방법에 대한 사례 공유입니다.
tags: [codereview, code, review]
fullview: true
---

# 토스랩 안드로이드팀이 코드리뷰 하는 방법

[실리콘밸리 이야기 - 코드리뷰는 어떻게 하나요?](http://sv-story.blogspot.kr/2013/04/blog-post_28.html) 를 보고 토스랩이 코드리뷰 하는 프로세스와 방법에 대해서 공유해드리고자 합니다.

## 왜 코드리뷰를 하게 되었나요?

토스랩에 안드로이드가 팀 단위로 꾸려진 것은 5월 전후였습니다. 그 전에는 1인 개발 체제를 가지고 있었습니다. 갑작스럽게 인원이 많아지면서 코드스타일, 구조의 일관성 등이 계속적으로 깨지게 되고 이에 따라 제품의 안정성도 급격히 떨어지는 사태가 발생하였습니다.

이에 내부적으로 제품의 품질을 강화하기 위한 대책들이 강구되었는데 그 중에 하나가 코드리뷰였습니다.

코드리뷰를 위한 프로세스는 토스랩 웹 개발팀의 프로세스를 참고하여 안드로이드 개발 팀원의 내부 의견을 반영하여 진행되었습니다.

## 1. 언제 코드리뷰를 요청하나요?
안드로이드팀은 코드리뷰 요청에 대해 별도의 제약을 두지 않았습니다. 언제든지 코드리뷰 시스템이 코드리뷰를 요청할 수 있습니다. 다만 코드 리뷰가 시작되는 시점이 조금 다릅니다.

모든 개발자가 코드리뷰를 각자의 업무(Task)가 완료되면 코드리뷰 시스템에 코드리뷰를 요청하고 이를 각 개발자가 언제든지 확인할 수 있도록 하고 있습니다.

코드리뷰의 시작은 [3. 그럼 코드리뷰는 언제 하나요?](#3.-코드리뷰는-언제-하나요) 에서 확인해보록 하겠습니다.

## 2. 어떻게 요청하나요
코드리뷰는 내가 아닌 다른 사람이 코드를 읽어야 하므로 어떤 목적에서 작업 된 코드인지를 미리 할 수 있어야 빠르게 코드리뷰를 할 수 있습니다. 최대한 자유롭게 하되 아래와 같은 형식을 지키도록 하고 있습니다.

* Title
 * Feature/Bug-fix 건인지 알 수 있도록 합니다.
 * 어떤 목적인지 간략하게 적도록 합니다.
 * 어떤 이슈와 연결된 건인지 알 수 있도록 합니다.

* Description
 * 어떤 로직을 추가/수정했는지를 작성합니다.
 * 어떻게 추가/수정했는지를 작성합니다

### ex)

> Title - [fix] 소켓 API 버전 처리 (JND-3986)


Description
1. ```@Version``` 커스텀 어노테이션 추가
2. Version 없는 Event 에 Version 필드 추가, ```@Version```어노테이션 부여
3. SocketObject -> EventObject 로 파싱하는 로직 공통 메소드로 분리
4. 파싱 후 바로 반환하지 않고 Version Valid 로직 추가


```java
class JandiSocketServiceModel {
    T getObject(Object, T) // 파싱 공통 메소드
    boolean validVersion(Object) // version 확인
}
```

  * Java Reflection 사용.

위와 같이 작성함으로써 이 이슈는 소켓 API 버전에 대한 버그 수정건으로 JND-3986 이라는 이슈와 연관된 것임을 알 수 있습니다. 상세 내용으로는 @Version 이 JandiSocketServiceModel의 getOject 와  validVersion 메소드와 연관되어 있음을 알 수 있도록 기술하였습니다.

코드리뷰를 상세하게 쓰는 것은 리뷰어들이 코드리뷰를 효율적으로 하기 위함이기 때문에 리뷰할 부분을 빨리 확인 할 수 있게 적도록 하도 있습니다.

## <a name="3.-코드리뷰는-언제-하나요"></a>3. 그럼 코드리뷰는 언제 하나요?
실리콘 밸리의 큰 회사들 (구글, 페이스북 등)은 코드리뷰가 요청이 오면 업무의 최우선순위로 조정되어 즉시 응답하도록 하는 것이 원칙입니다.
(지금 당장 하든지 아니면 언제부터 할 것인지를 피드백을 반드시 줘야 한다고 들었습니다.)

하지만 스타트업은 일반적으로 개발해야 할 것들이 훨씬 더 많고 코드리뷰가 아니더라도 일이 산더미인 경우가 많습니다. 저희 토스랩이라고 이를 크게 벗어나지 않기 때문에 안드로이드팀은 별도로 코드리뷰하는 프로세스를 정의하였습니다.

1. 월~수 : feature/bug-fix 개발이 업무의 최우선 순위이다.
2. 목, 금 : 코드리뷰가 업무의 최우선 순위이며 코드리뷰 대상은 목요일 출근 전까지 리뷰 요청을 한 건을 대상으로 한다.

이는 개발자들끼리 코드리뷰의 중요성을 이해하지만, 이것이 개발 건보다 더 큰 업무 비중을 차지하게 되면 개발 속도나 의욕을 저해할 수 있기 때문에 최대한 분리하여 해당 건에만 집중하기 위해 룰을 정하였습니다.

업무에 따라서 편차는 있지만, 대개의 코드리뷰는 금요일에 모두 완료를 하고 있으며 긍정적 피드백이 나올때까지 코드를 변경해야만 완료가 됩니다.

## 4. 무엇을 리뷰하나요?
개발자 개인의 성향과 개발건의 성격에 따라 그때마다 다른 모습을 보여줍니다. 

* 성능 개선 개발 : **시간복잡도**
* 신규 feature 개발 : **잠재적인 오류**에 대한 검출
* 리팩토링 : **테스트코드나 구조에 대한 물음**
* 신규 기술 도입 : **해당 기술의 로직과 그에 대한 물음**
* 기타 : 변수명과 같은 **코드 컨벤션**을 하기도 합니다. 전체적인 흐름을 이해하기 위해 **실제 빌드를 해서 동작**을 시켜보고 이해하기도 합니다.

기본적인 사항들은 CI 품질도구 리포팅 기능을 이용하기 때문에 주로 큰 그림에서의 코드리뷰를 하는 편입니다.

## 5. 코드리뷰 코멘트는 어떻게 작성하나요?
* OO 보다는 XX 가 더 나은 것 같아요.
* XX 는 OO 부분을 참고해서 이용하면 되요.
* OO 는 XX 에 의해서 문제되지 않을까요?
* XX 를 하려다가 OO 로 했는데 어떻게 생각하세요?

위와 같이 가급적이면 상대방을 공격하지 않는 느낌을 주도록 하며 단순히 문제를 이슈업하기 보다는 대안을 제시하는 방법을 주로 하고 있습니다. 코드리뷰는 서로의 코드에서 이해할 수 없는 부분을 찾고 문제가 될 수 있는 부분을 미리 찾아내는 자리인만큼 문제의 검출과 해결에 주안을 두고 진행합니다.

## 6. 코드리뷰가 끝나면 어떻게 하나요?
서로가 이해할 수 있을 만큼 리뷰가 진행되면 코드는 그때서야 개발용 브랜치에 통합을 합니다. 최소 1명의 피드백도 진행되지 않은 코드는 통합하지 않는 것이 원칙으로 하며 통합되어야 하는 건이 코드리뷰가 진행되지 않으면 늦어도 월요일 아침에 긴급히 진행해 줄 것을 환기시킵니다.

## 7. 긴급히 코드리뷰해야 하는 건은 어떻게 하나요?
긴급히 해야하는 건은 그만큼 사안이 중요하다고 생각하기 때문에 리뷰를 요청하는 즉시 진행을 하도록 합니다. 다만 해당 건이 즉시 반영해야 할만큼 중요한지를 서로간의 의논해서 진행하도록 합니다.

## 총평
안드로이드팀이 코드리뷰를 최초 시작한 것은 6월초입니다. 브랜치를 통합하기 전 개발 완료된 건에 대한 코드리뷰가 처음이었기 때문에 자리를 잡는데는 2달여 시간이 흐른 다음이었습니다. 초기에는 실수로 코드리뷰를 생략한다던가, 어떻게 코멘트를 남겨야할지에 대해서 조심스럽다던가 하는 시행착오를 겪어서 지금은 개발 건에 따라 20건이 넘는 의견이 남겨질 정도로 활발하게 의견을 교류하고 통합을 거칩니다.

코드리뷰에 생소한 사람은 대개 나의 작업물을 누군가에게 검토 받는다는 느낌에 거부감을 가지기 마련입니다. 하지만 더 큰 그림에서 본다면 코드리뷰는 코드의 안정성을 서로 다른 관점에서 검토하는 것이기 때문에 코드의 신뢰성이 더욱 커지는 과정입니다. 그러기에 이에 대한 이해 없이 진행하는 코드리뷰는 금방 유명무실해지기 때문에 모두의 이해를 가진 다음에 진행 할 것을 추천합니다.

제품의 안정성을 신경써야 하는 시점에 QA 강화와 같은 외부의 요인만을 찾는 것보다 내부에서 좀 더 개선 할 수 있는 요인을 찾는 것도 하나의 방법입니다. 토스랩에서는 다양한 품질 검증 과정에서 코드리뷰를 매우 중시하고 있습니다. 모든 팀이 각자만의 스타일대로 코드리뷰를 진행하고 있습니다.

모든 개발자분들이 코드리뷰에 열린 자세로 올바른 코드리뷰를 진행하기를 바랍니다.